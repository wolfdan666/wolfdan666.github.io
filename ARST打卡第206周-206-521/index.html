<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.wolfdan.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.8.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="lc1019_链表中的下一个更大节点 坚持30天僧人般严苛自律的生活_思考 大佬的工作10周年感想 RAFT加ROCKSDB重新思考 rocksdb6.29版本编译安装使用测试">
<meta property="og:type" content="article">
<meta property="og:title" content="ARST打卡第206周[206&#x2F;521]">
<meta property="og:url" content="https://www.wolfdan.cn/ARST%E6%89%93%E5%8D%A1%E7%AC%AC206%E5%91%A8-206-521/">
<meta property="og:site_name" content="单林敏的博客">
<meta property="og:description" content="lc1019_链表中的下一个更大节点 坚持30天僧人般严苛自律的生活_思考 大佬的工作10周年感想 RAFT加ROCKSDB重新思考 rocksdb6.29版本编译安装使用测试">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-04-13T13:52:08.000Z">
<meta property="article:modified_time" content="2023-04-13T14:23:04.589Z">
<meta property="article:author" content="单林敏">
<meta property="article:tag" content="ARST">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.wolfdan.cn/ARST%E6%89%93%E5%8D%A1%E7%AC%AC206%E5%91%A8-206-521/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.wolfdan.cn/ARST%E6%89%93%E5%8D%A1%E7%AC%AC206%E5%91%A8-206-521/","path":"ARST打卡第206周-206-521/","title":"ARST打卡第206周[206/521]"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ARST打卡第206周[206/521] | 单林敏的博客</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?953c0cc2db0f1124313d72b95b9d07e1"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">单林敏的博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">wolfdan's blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-捐赠"><a href="/%E6%8D%90%E8%B5%A0/" rel="section"><i class="fa fa-coins fa-fw"></i>捐赠</a></li>
        <li class="menu-item menu-item-冲冲"><a href="/%E5%86%B2%E5%86%B2%E5%86%B2/" rel="section"><i class="fa fa-rocket fa-fw"></i>冲冲</a></li>
        <li class="menu-item menu-item-友链"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Algorithm"><span class="nav-number">1.</span> <span class="nav-text">Algorithm</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Review"><span class="nav-number">2.</span> <span class="nav-text">Review</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tips"><span class="nav-number">3.</span> <span class="nav-text">Tips</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Share-rocksdb6-29%E7%89%88%E6%9C%AC%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E6%B5%8B%E8%AF%95"><span class="nav-number">4.</span> <span class="nav-text">Share-rocksdb6.29版本编译安装使用测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="nav-number">4.1.</span> <span class="nav-text">环境说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%AE%89%E8%A3%85"><span class="nav-number">4.2.</span> <span class="nav-text">依赖安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="nav-number">4.3.</span> <span class="nav-text">静态编译安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%94%A8%E4%BE%8B%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C"><span class="nav-number">4.4.</span> <span class="nav-text">简单用例编译运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E9%80%94%E5%8F%AF%E8%83%BD%E4%BC%9A%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="nav-number">4.4.1.</span> <span class="nav-text">中途可能会遇到的一些问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%91%E6%B5%8B%E8%AF%95"><span class="nav-number">4.5.</span> <span class="nav-text">跑测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91db-bench%E5%B9%B6%E4%B8%94%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC"><span class="nav-number">4.5.1.</span> <span class="nav-text">编译db_bench并且简单测试脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%91benchmark-sh-bulkload"><span class="nav-number">4.5.2.</span> <span class="nav-text">跑benchmark.sh bulkload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3"><span class="nav-number">4.5.3.</span> <span class="nav-text">测试报告简单理解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%91%E7%82%B9%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E5%90%A7"><span class="nav-number">4.6.</span> <span class="nav-text">跑点高级特性吧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96-%E6%B8%85%E7%90%86"><span class="nav-number">4.7.</span> <span class="nav-text">其他(清理)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">4.8.</span> <span class="nav-text">参考链接</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="单林敏"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">单林敏</p>
  <div class="site-description" itemprop="description">心外无物,知行合一</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">321</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">93</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wolfdan666" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wolfdan666" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wolfdan666666@gmail.com" title="E-Mail → mailto:wolfdan666666@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/shanlinmin/activities" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;shanlinmin&#x2F;activities" rel="noopener" target="_blank"><i class="free-code-camp fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/53acec957bf9" title="简书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;53acec957bf9" rel="noopener" target="_blank"><i class="book fa-fw"></i>简书</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://me.csdn.net/neve_give_up_dan" title="CSDN → https:&#x2F;&#x2F;me.csdn.net&#x2F;neve_give_up_dan" rel="noopener" target="_blank"><i class="rotate-right fa-fw"></i>CSDN</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.wolfdan.cn/ARST%E6%89%93%E5%8D%A1%E7%AC%AC206%E5%91%A8-206-521/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="单林敏">
      <meta itemprop="description" content="心外无物,知行合一">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="单林敏的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ARST打卡第206周[206/521]
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-04-13 21:52:08 / 修改时间：22:23:04" itemprop="dateCreated datePublished" datetime="2023-04-13T21:52:08+08:00">2023-04-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ARST/" itemprop="url" rel="index"><span itemprop="name">ARST</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">lc1019_链表中的下一个更大节点 坚持30天僧人般严苛自律的生活_思考 大佬的工作10周年感想 RAFT加ROCKSDB重新思考 rocksdb6.29版本编译安装使用测试</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h1><p>lc1019_链表中的下一个更大节点</p>
<ul>
<li>链表中节点数为 n</li>
<li>1 &lt;= n &lt;= 1e4</li>
<li>1 &lt;= Node.val &lt;= 1e9</li>
</ul>
<p>思路: </p>
<ul>
<li>因为 n 的取值范围的问题，可以O(n^2)，所以应该可以暴力法</li>
<li>优化的方法应该是双指针，先一个找到，然后记录右指针，右指针左边的值一定小于左指针和自己。中间的值可以维护一个有序容器，multiset(注意这里删除就不要删除值，而是删除一个迭代器指针指向的位置)。空间换时间。</li>
<li>再优化一点，就是一开始把所有值都先插入进去，然后一个个比较删除即可。时间复杂度O(nlogn)和空间复杂度是O(n)。</li>
</ul>
<p>结果一看<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/next-greater-node-in-linked-list/solutions/2216789/lian-biao-zhong-de-xia-yi-ge-geng-da-jie-u9yo/">题解</a>，发现确实就是典型的单调栈经典问题，惭愧了，又忘了…</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">nextLargerNodes</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; ans;</span><br><span class="line">        stack&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; s;</span><br><span class="line"></span><br><span class="line">        ListNode* cur = head;</span><br><span class="line">        <span class="keyword">int</span> idx = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span> (cur) &#123;</span><br><span class="line">            ++idx;</span><br><span class="line">            ans.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">while</span> (!s.<span class="built_in">empty</span>() &amp;&amp; s.<span class="built_in">top</span>().first &lt; cur-&gt;val) &#123;</span><br><span class="line">                ans[s.<span class="built_in">top</span>().second] = cur-&gt;val;</span><br><span class="line">                s.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            s.<span class="built_in">emplace</span>(cur-&gt;val, idx);</span><br><span class="line">            cur = cur-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Review"><a href="#Review" class="headerlink" title="Review"></a>Review</h1><p>坚持30天僧人般严苛自律的生活_思考</p>
<div align = "center">
    <iframe  width="100%" height="700" src="//player.bilibili.com/player.html?aid=397306131&bvid=BV18o4y1n7Xd&cid=1088858783&page=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>

<p>博主想表达的不仅仅是自律，更多的是要体会自己内心的需求，<strong>接受好的不好的自己，倾听自己内心的声音，不是一味地逃避自己不喜欢的一面，而是要学会与它相处，体会真正的诉求，毕竟所有这些才组成了真正的我们，这些不同的人格都是为了保护我们，或者让我们更好，学会与他们相处，而不是把他们当做敌人，过多的压抑会遭到反噬，和谐的相处体会才能得到更好的效果，无论是工作还是生活中。</strong></p>
<h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><p>大佬<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/352213790">写在工作10周年</a></p>
<p>在这个行业做的久了, 你就会越加的尊敬Oracle. 在单机存储引擎领域, Oracle 做的真的是非常的极致, 现在PolarDB 能够和Oracle PK 也只是因为赛道变了, 但是在单机存储引擎上, 我仍然觉得Oracle 很多地方值得我们学习. <strong>所以不管别人怎么说, 我还是觉得 Oracle, AWS aurora 团队那些糟老头子比我们强, 一定有很多值得我们学习的地方, 我还是觉得数据库领域是慢工出细活, 没有所谓的灵光一闪, 只有日积月累.</strong></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/478705155">RAFT加ROCKSDB重新思考</a></p>
<p>看懂了一些(比如: WAL写入基于Qurom机制进行，可以有效的规避掉慢节点。)，但是还有一些处于懵懂状态，存储行业还是学海无涯，继续学习。</p>
<h1 id="Share-rocksdb6-29版本编译安装使用测试"><a href="#Share-rocksdb6-29版本编译安装使用测试" class="headerlink" title="Share-rocksdb6.29版本编译安装使用测试"></a>Share-rocksdb6.29版本编译安装使用测试</h1><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><ul>
<li>Ubuntu18.04 (Windows Subsystem for Linux, WSL2)</li>
<li>GCC4.8, C++11</li>
<li>RocksDB6.29b (RocksDB7.0以上版本需要GCC7 和 C++17了，所以这里用的是6.29b，只需要C++11, GCC4.8)</li>
</ul>
<h2 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h2><p>按照<a target="_blank" rel="noopener" href="https://github.com/facebook/rocksdb/blob/6.29.fb/INSTALL.md">6.29b的官方教程</a>把依赖都装好</p>
<p>也可以一键安装一些依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以先更新一下软件包的情况</span></span><br><span class="line"><span class="comment"># sudo apt-get update </span></span><br><span class="line">sudo apt-get install libsnappy-dev zlib1g-dev libbz2-dev liblz4-dev libzstd-dev libgflags-dev</span><br></pre></td></tr></table></figure>

<h2 id="静态编译安装"><a href="#静态编译安装" class="headerlink" title="静态编译安装"></a>静态编译安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make static_lib -j$(nproc)</span><br><span class="line">make install-static -j$(nproc)</span><br></pre></td></tr></table></figure>
<p><em><code>-j$(nproc)</code> 是使用机器的全部CPU，根据本身机器的CPU数来合理设置，比如配置成<code>-j$(($(nproc) / 2))</code></em></p>
<h2 id="简单用例编译运行"><a href="#简单用例编译运行" class="headerlink" title="简单用例编译运行"></a>简单用例编译运行</h2><ul>
<li>创建数据库测试目录并且编码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/code/rocksdb</span><br><span class="line">mkdir /tmp/rocksdb_tmp</span><br><span class="line"></span><br><span class="line"> ⚡ 04/13|10:57:46  rocksdb   6.29.fb  vim test.cpp</span><br><span class="line"> ⚡ 04/13|10:57:58  rocksdb   6.29.fb  cat test.cpp</span><br><span class="line"><span class="comment">#include &lt;cstdio&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string&gt;</span></span><br><span class="line"><span class="comment">#include &quot;rocksdb/db.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;rocksdb/slice.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;rocksdb/options.h&quot;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">using namespace rocksdb;</span><br><span class="line"></span><br><span class="line">const std::string PATH = <span class="string">&quot;/tmp/rocksdb_tmp&quot;</span>;</span><br><span class="line">int <span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">    DB* db;</span><br><span class="line">    Options options;</span><br><span class="line">    options.create_if_missing = <span class="literal">true</span>;</span><br><span class="line">    Status status = DB::Open(options, PATH, &amp;db);</span><br><span class="line">    assert(status.ok());</span><br><span class="line">    Slice key(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">    Slice value(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    std::string get_value;</span><br><span class="line">    status = db-&gt;Put(WriteOptions(), key, value);</span><br><span class="line">    <span class="keyword">if</span>(status.ok())&#123;</span><br><span class="line">        status = db-&gt;Get(ReadOptions(), key, &amp;get_value);</span><br><span class="line">        <span class="keyword">if</span>(status.ok())&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;get %s success!!\n&quot;</span>, get_value.c_str());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;get failed\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;put failed\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    delete db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>进行编译运行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> ⚡ 04/13|10:31:32  rocksdb   6.29.fb  g++ test.cpp -o test.out -std=c++11  -lrocksdb -lz -lbz2 -lsnappy -pthread -lzstd -llz4 -ldl</span><br><span class="line"> ⚡ 04/13|10:33:35  rocksdb   6.29.fb  ./test.out</span><br><span class="line">get bar success!!</span><br></pre></td></tr></table></figure>

<p>参数<br>-L：表示要连接的库所在目录 (这里没用到)<br>-l：指定链接时需要的动/静态库。<br>注意: 编译器查找动态连接库时有隐含的命名规则，即在给出的名字前面加上lib，后面加上.a或.so来确定库的名称。</p>
<p><strong>所以编译生成的是 librocksdb.a 需要写成 <code>-lrocksdb</code> 的样子</strong></p>
<h3 id="中途可能会遇到的一些问题"><a href="#中途可能会遇到的一些问题" class="headerlink" title="中途可能会遇到的一些问题"></a>中途可能会遇到的一些问题</h3><p>Q: rocksdb/./util/compression.h:116: undefined reference to <code>ZSTD_freeDCtx&#39; A: 编译加 </code>-lzstd<code>, 也即</code>g++ test.cpp -o test.out -std=c++11  -lrocksdb -lz -lbz2 -lsnappy -pthread -lzstd`</p>
<p>Q: rocksdb/./util/compression.h:1074: undefined reference to <code>LZ4_compressBound&#39; A: 同理加</code>-llz4<code>, 即</code>g++ test.cpp -o test.out -std=c++11  -lrocksdb -lz -lbz2 -lsnappy -pthread -lzstd -llz4`</p>
<p>Q: rocksdb/env/env_posix.cc:108: undefined reference to <code>dlclose&#39; A: 增加动态链接选项 </code>-ldl<code>，即</code>g++ test.cpp -o test.out -std=c++11  -lrocksdb -lz -lbz2 -lsnappy -pthread -lzstd -llz4 -ldl`<br><em>这里乌龙，把dl写成了ld一会儿</em></p>
<h2 id="跑测试"><a href="#跑测试" class="headerlink" title="跑测试"></a>跑测试</h2><h3 id="编译db-bench并且简单测试脚本"><a href="#编译db-bench并且简单测试脚本" class="headerlink" title="编译db_bench并且简单测试脚本"></a>编译db_bench并且简单测试脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译时间有点久，尽量多搞点CPU</span></span><br><span class="line"> ⚡ 04/13|11:28:26  rocksdb   6.29.fb  make db_bench -j$(nproc)</span><br><span class="line"><span class="variable">$DEBUG_LEVEL</span> is 1</span><br><span class="line">Makefile:170: Warning: Compiling <span class="keyword">in</span> debug mode. Don.t use the resulting binary <span class="keyword">in</span> production</span><br><span class="line"><span class="comment"># ...很多 CC 编译</span></span><br><span class="line">  AR       librocksdb_debug.a</span><br><span class="line">/usr/bin/ar: creating librocksdb_debug.a</span><br><span class="line">  CCLD     db_bench</span><br><span class="line"> ⚡ 04/13|11:35:16  rocksdb   6.29.fb </span><br><span class="line"> ⚡ 04/13|11:35:16  rocksdb   6.29.fb  ./db_bench</span><br><span class="line">Initializing RocksDB Options from the specified file</span><br><span class="line">Initializing RocksDB Options from command-line flags</span><br><span class="line">RocksDB:    version 6.29</span><br><span class="line">Date:       Thu Apr 13 11:37:14 2023</span><br><span class="line">CPU:        6 * Intel(R) Core(TM) i5-8500 CPU @ 3.00GHz</span><br><span class="line">CPUCache:   9216 KB</span><br><span class="line">Keys:       16 bytes each (+ 0 bytes user-defined timestamp)</span><br><span class="line">Values:     100 bytes each (50 bytes after compression)</span><br><span class="line">Entries:    1000000</span><br><span class="line">Prefix:    0 bytes</span><br><span class="line">Keys per prefix:    0</span><br><span class="line">RawSize:    110.6 MB (estimated)</span><br><span class="line">FileSize:   62.9 MB (estimated)</span><br><span class="line">Write rate: 0 bytes/second</span><br><span class="line">Read rate: 0 ops/second</span><br><span class="line">Compression: Snappy</span><br><span class="line">Compression sampling rate: 0</span><br><span class="line">Memtablerep: SkipListFactory</span><br><span class="line">Perf Level: 1</span><br><span class="line">WARNING: Assertions are enabled; benchmarks unnecessarily slow</span><br><span class="line">------------------------------------------------</span><br><span class="line">Initializing RocksDB Options from the specified file</span><br><span class="line">Initializing RocksDB Options from command-line flags</span><br><span class="line">DB path: [/tmp/rocksdbtest-0/dbbench]</span><br><span class="line">fillseq      :       3.444 micros/op 290364 ops/sec;   32.1 MB/s</span><br><span class="line">Please disable_auto_compactions <span class="keyword">in</span> FillDeterministic benchmark</span><br><span class="line"> ✘ ⚡ 04/13|11:39:44  rocksdb   6.29.fb  ./db_bench --disable_auto_compactions=<span class="literal">true</span></span><br><span class="line">Initializing RocksDB Options from the specified file</span><br><span class="line">Initializing RocksDB Options from command-line flags</span><br><span class="line">RocksDB:    version 6.29</span><br><span class="line">Date:       Thu Apr 13 11:40:04 2023</span><br><span class="line">CPU:        6 * Intel(R) Core(TM) i5-8500 CPU @ 3.00GHz</span><br><span class="line">CPUCache:   9216 KB</span><br><span class="line">Keys:       16 bytes each (+ 0 bytes user-defined timestamp)</span><br><span class="line">Values:     100 bytes each (50 bytes after compression)</span><br><span class="line">Entries:    1000000</span><br><span class="line">Prefix:    0 bytes</span><br><span class="line">Keys per prefix:    0</span><br><span class="line">RawSize:    110.6 MB (estimated)</span><br><span class="line">FileSize:   62.9 MB (estimated)</span><br><span class="line">Write rate: 0 bytes/second</span><br><span class="line">Read rate: 0 ops/second</span><br><span class="line">Compression: Snappy</span><br><span class="line">Compression sampling rate: 0</span><br><span class="line">Memtablerep: SkipListFactory</span><br><span class="line">Perf Level: 1</span><br><span class="line">WARNING: Assertions are enabled; benchmarks unnecessarily slow</span><br><span class="line">------------------------------------------------</span><br><span class="line">Initializing RocksDB Options from the specified file</span><br><span class="line">Initializing RocksDB Options from command-line flags</span><br><span class="line">DB path: [/tmp/rocksdbtest-0/dbbench]</span><br><span class="line">fillseq      :       3.601 micros/op 277713 ops/sec;   30.7 MB/s</span><br><span class="line">Initializing RocksDB Options from the specified file</span><br><span class="line">Initializing RocksDB Options from command-line flags</span><br><span class="line">DB path: [/tmp/rocksdbtest-0/dbbench]</span><br><span class="line">n is too small to fill 7 levels</span><br><span class="line"> ✘ ⚡ 04/13|11:40:15  rocksdb   6.29.fb </span><br></pre></td></tr></table></figure>

<h3 id="跑benchmark-sh-bulkload"><a href="#跑benchmark-sh-bulkload" class="headerlink" title="跑benchmark.sh bulkload"></a>跑benchmark.sh bulkload</h3><p>在 benchmark.sh 脚本中，如果没有指定 –duration 或者 –num 选项，那么 bulkload 基准测试模式将会一直运行下去，直到手动停止脚本或者遇到错误。这种情况下，测试的持续时间将会取决于数据集的大小以及 RocksDB 的写入性能。如果测试数据集较小或者 RocksDB 的写入性能较低，测试可能需要很长时间才能结束。</p>
<p>因此，在运行 benchmark.sh 脚本时，建议使用 –duration 或者 –num 选项来限制测试的持续时间或者测试数据集的大小。这样可以避免测试持续时间过长或者测试数据集过大导致的问题。同时，需要根据实际情况来调整测试参数以获得更好的测试效果。</p>
<p>比如: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./tools/benchmark.sh bulkload --num=10000000 --value_size=100 --duration=180</span><br></pre></td></tr></table></figure>
<p>在这个命令中，–duration=180 选项指定测试持续时间为 180 秒。同时，–num=10000000 选项指定测试数据集的大小为 1000 万个键值对，–value_size=100 选项指定每个值的大小为 100 字节。需要注意的是，延长测试时间可能会增加测试的负载和资源占用，因此需要根据实际情况进行调整。</p>
<p><em>下面是我的测试，第一次跑没有限定时间和文件大小，跑了很久很久才手动 ctrl+c掉，然后才想到可能需要设定时间，才找到duration参数</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/rocksdb</span><br><span class="line"><span class="built_in">export</span> DB_DIR=/tmp/rocksdb/db</span><br><span class="line"><span class="built_in">export</span> WAL_DIR=/tmp/rocksdb/wal</span><br><span class="line"><span class="built_in">export</span> TEMP=/tmp/rocksdb/tmp</span><br><span class="line"><span class="built_in">export</span> OUTPUT_DIR=/tmp/rocksdb/output</span><br><span class="line"></span><br><span class="line"> ⚡ 04/13|11:40:15  rocksdb   6.29.fb  ./tools/benchmark.sh bulkload</span><br><span class="line">===== Benchmark =====</span><br><span class="line">Starting bulkload (ID: ) at Thu Apr 13 11:41:23 CST 2023</span><br><span class="line">Bulk loading 8000000000 random keys</span><br><span class="line">./db_bench --benchmarks=fillrandom --use_existing_db=0 --disable_auto_compactions=1 --sync=0 --max_background_compactions=16 --max_write_buffer_number=8 --allow_concurrent_memtable_write=<span class="literal">false</span> --max_background_flushes=7 --level0_file_num_compaction_trigger=10485760 --level0_slowdown_writes_trigger=10485760 --level0_stop_writes_trigger=10485760 --db=/tmp/rocksdb/db --wal_dir=/tmp/rocksdb/wal --num=8000000000 --num_levels=6 --key_size=20 --value_size=400 --block_size=8192 --cache_size=17179869184 --cache_numshardbits=6 --compression_max_dict_bytes=0 --compression_ratio=0.5 --compression_type=zstd --level_compaction_dynamic_level_bytes=<span class="literal">true</span> --bytes_per_sync=8388608 --cache_index_and_filter_blocks=0 --pin_l0_filter_and_index_blocks_in_cache=1 --benchmark_write_rate_limit=0 --hard_rate_limit=3 --rate_limit_delay_max_milliseconds=1000000 --write_buffer_size=134217728 --target_file_size_base=134217728 --max_bytes_for_level_base=1073741824 --verify_checksum=1 --delete_obsolete_files_period_micros=62914560 --max_bytes_for_level_multiplier=8 --statistics=0 --stats_per_interval=1 --stats_interval_seconds=60 --histogram=1 --memtablerep=skip_list --bloom_bits=10 --open_files=-1 --threads=1 --memtablerep=vector --allow_concurrent_memtable_write=<span class="literal">false</span> --disable_wal=1 --seed=1681357283 2&gt;&amp;1 | tee -a /tmp/rocksdb/output/benchmark_bulkload_fillrandom.log</span><br><span class="line">RocksDB:    version 6.29</span><br><span class="line">Date:       Thu Apr 13 11:41:23 2023</span><br><span class="line">CPU:        6 * Intel(R) Core(TM) i5-8500 CPU @ 3.00GHz</span><br><span class="line">CPUCache:   9216 KB</span><br><span class="line">2023/04/13-11:42:24  ... thread 0: (25745000,25745000) ops and (428780.8,428780.8) ops/second <span class="keyword">in</span> (60.042332,60.042332) seconds</span><br><span class="line"></span><br><span class="line">** Compaction Stats [default] **</span><br><span class="line">Level    Files   Size     Score Read(GB)  Rn(GB) Rnp1(GB) Write(GB) Wnew(GB) Moved(GB) W-Amp Rd(MB/s) Wr(MB/s) Comp(sec) CompMergeCPU(sec) Comp(cnt) Avg(sec) KeyIn KeyDrop Rblob(GB) Wblob(GB)</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">  L0     77/0    4.20 GB   4.2      0.0     0.0      0.0       4.2      4.2       0.0   1.0      0.0     13.4    320.08            109.05        77    4.157       0      0       0.0       0.0</span><br><span class="line"> Sum     77/0    4.20 GB   0.0      0.0     0.0      0.0       4.2      4.2       0.0   1.0      0.0     13.4    320.08            109.05        77    4.157       0      0       0.0       0.0</span><br><span class="line"> Int      0/0    0.00 KB   0.0      0.0     0.0      0.0       4.2      4.2       0.0   1.0      0.0     13.4    320.08            109.05        77    4.157       0      0       0.0       0.0</span><br><span class="line"></span><br><span class="line">** Compaction Stats [default] **</span><br><span class="line">Priority    Files   Size     Score Read(GB)  Rn(GB) Rnp1(GB) Write(GB) Wnew(GB) Moved(GB) W-Amp Rd(MB/s) Wr(MB/s) Comp(sec) CompMergeCPU(sec) Comp(cnt) Avg(sec) KeyIn KeyDrop Rblob(GB) Wblob(GB)</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">High      0/0    0.00 KB   0.0      0.0     0.0      0.0       4.2      4.2       0.0   0.0      0.0     13.4    320.08            109.05        77    4.157       0      0       0.0       0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 很多日志</span></span><br><span class="line"></span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line"> ⚡ 04/13|15:01:29  rocksdb   6.29.fb  ./tools/benchmark.sh bulkload --num=10000000 --value_size=100 --duration=180</span><br><span class="line">===== Benchmark =====</span><br><span class="line">Starting bulkload (ID: ) at Thu Apr 13 15:01:40 CST 2023</span><br><span class="line">Bulk loading 8000000000 random keys</span><br><span class="line">./db_bench --benchmarks=fillrandom --use_existing_db=0 --disable_auto_compactions=1 --sync=0 --max_background_compactions=16 --max_write_buffer_number=8 --allow_concurrent_memtable_write=<span class="literal">false</span> --max_background_flushes=7 --level0_file_num_compaction_trigger=10485760 --level0_slowdown_writes_trigger=10485760 --level0_stop_writes_trigger=10485760 --db=/tmp/rocksdb/db --wal_dir=/tmp/rocksdb/wal --num=8000000000 --num_levels=6 --key_size=20 --value_size=400 --block_size=8192 --cache_size=17179869184 --cache_numshardbits=6 --compression_max_dict_bytes=0 --compression_ratio=0.5 --compression_type=zstd --level_compaction_dynamic_level_bytes=<span class="literal">true</span> --bytes_per_sync=8388608 --cache_index_and_filter_blocks=0 --pin_l0_filter_and_index_blocks_in_cache=1 --benchmark_write_rate_limit=0 --hard_rate_limit=3 --rate_limit_delay_max_milliseconds=1000000 --write_buffer_size=134217728 --target_file_size_base=134217728 --max_bytes_for_level_base=1073741824 --verify_checksum=1 --delete_obsolete_files_period_micros=62914560 --max_bytes_for_level_multiplier=8 --statistics=0 --stats_per_interval=1 --stats_interval_seconds=60 --histogram=1 --memtablerep=skip_list --bloom_bits=10 --open_files=-1 --num=10000000 --value_size=100 --duration=180 --threads=1 --memtablerep=vector --allow_concurrent_memtable_write=<span class="literal">false</span> --disable_wal=1 --seed=1681369300 2&gt;&amp;1 | tee -a /tmp/rocksdb/output/benchmark_bulkload_fillrandom.log</span><br><span class="line">RocksDB:    version 6.29</span><br><span class="line">Date:       Thu Apr 13 15:01:47 2023</span><br><span class="line">CPU:        6 * Intel(R) Core(TM) i5-8500 CPU @ 3.00GHz</span><br><span class="line">CPUCache:   9216 KB</span><br><span class="line">2023/04/13-15:02:48  ... thread 0: (31184000,31184000) ops and (519717.6,519717.6) ops/second <span class="keyword">in</span> (60.001818,60.001818) seconds</span><br><span class="line"></span><br><span class="line">** Compaction Stats [default] **</span><br><span class="line">Level    Files   Size     Score Read(GB)  Rn(GB) Rnp1(GB) Write(GB) Wnew(GB) Moved(GB) W-Amp Rd(MB/s) Wr(MB/s) Comp(sec) CompMergeCPU(sec) Comp(cnt) Avg(sec) KeyIn KeyDrop Rblob(GB) Wblob(GB)</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">  L0     25/0    1.29 GB   1.3      0.0     0.0      0.0       1.3      1.3       0.0   1.0      0.0      4.5    294.22             54.30        25   11.769       0      0       0.0       0.0</span><br><span class="line"> Sum     25/0    1.29 GB   0.0      0.0     0.0      0.0       1.3      1.3       0.0   1.0      0.0      4.5    294.22             54.30        25   11.769       0      0       0.0       0.0</span><br><span class="line"> Int      0/0    0.00 KB   0.0      0.0     0.0      0.0       1.3      1.3       0.0   1.0      0.0      4.5    294.22             54.30        25   11.769       0      0       0.0       0.0</span><br><span class="line"></span><br><span class="line">** Compaction Stats [default] **</span><br><span class="line">Priority    Files   Size     Score Read(GB)  Rn(GB) Rnp1(GB) Write(GB) Wnew(GB) Moved(GB) W-Amp Rd(MB/s) Wr(MB/s) Comp(sec) CompMergeCPU(sec) Comp(cnt) Avg(sec) KeyIn KeyDrop Rblob(GB) Wblob(GB)</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">High      0/0    0.00 KB   0.0      0.0     0.0      0.0       1.3      1.3       0.0   0.0      0.0      4.5    294.22             54.30        25   11.769       0      0       0.0       0.0</span><br><span class="line"></span><br><span class="line">Blob file count: 0, total size: 0.0 GB</span><br><span class="line"></span><br><span class="line">Uptime(secs): 60.5 total, 57.0 interval</span><br><span class="line">Flush(GB): cumulative 1.288, interval 1.288</span><br><span class="line">AddFile(GB): cumulative 0.000, interval 0.000</span><br><span class="line">AddFile(Total Files): cumulative 0, interval 0</span><br><span class="line">AddFile(L0 Files): cumulative 0, interval 0</span><br><span class="line">AddFile(Keys): cumulative 0, interval 0</span><br><span class="line">Cumulative compaction: 1.29 GB write, 21.80 MB/s write, 0.00 GB <span class="built_in">read</span>, 0.00 MB/s <span class="built_in">read</span>, 294.2 seconds</span><br><span class="line">Interval compaction: 1.29 GB write, 23.14 MB/s write, 0.00 GB <span class="built_in">read</span>, 0.00 MB/s <span class="built_in">read</span>, 294.2 seconds</span><br><span class="line">Stalls(count): 0 level0_slowdown, 0 level0_slowdown_with_compaction, 0 level0_numfiles, 0 level0_numfiles_with_compaction, 0 stop <span class="keyword">for</span> pending_compaction_bytes, 0 slowdown <span class="keyword">for</span> pending_compaction_bytes, 0 memtable_compaction, 23 memtable_slowdown, interval 23 total count</span><br><span class="line">Block cache LRUCache@0x55f687960330<span class="comment">#2714 capacity: 16.00 GB collections: 1 last_copies: 1 last_secs: 0.00024 secs_since: 61</span></span><br><span class="line">Block cache entry stats(count,size,portion): Misc(1,0.00 KB,0%)</span><br><span class="line"></span><br><span class="line">** File Read Latency Histogram By Level [default] **</span><br><span class="line"></span><br><span class="line">** DB Stats **</span><br><span class="line">Uptime(secs): 60.5 total, 57.0 interval</span><br><span class="line">Cumulative writes: 0 writes, 31M keys, 0 commit groups, 0.0 writes per commit group, ingest: 3.92 GB, 66.35 MB/s</span><br><span class="line">Cumulative WAL: 0 writes, 0 syncs, 0.00 writes per sync, written: 0.00 GB, 0.00 MB/s</span><br><span class="line">Cumulative stall: 00:00:35.883 H:M:S, 59.3 percent</span><br><span class="line">Interval writes: 0 writes, 29M keys, 0 commit groups, 0.0 writes per commit group, ingest: 3810.79 MB, 66.85 MB/s</span><br><span class="line">Interval WAL: 0 writes, 0 syncs, 0.00 writes per sync, written: 0.00 GB, 0.00 MB/s</span><br><span class="line">Interval stall: 00:00:35.883 H:M:S, 63.0 percent</span><br><span class="line"></span><br><span class="line">2023/04/13-15:03:48  ... thread 0: (27315000,58499000) ops and (455241.6,487479.8) ops/second <span class="keyword">in</span> (60.001110,120.002928) seconds</span><br><span class="line"></span><br><span class="line">** Compaction Stats [default] **</span><br><span class="line">Level    Files   Size     Score Read(GB)  Rn(GB) Rnp1(GB) Write(GB) Wnew(GB) Moved(GB) W-Amp Rd(MB/s) Wr(MB/s) Comp(sec) CompMergeCPU(sec) Comp(cnt) Avg(sec) KeyIn KeyDrop Rblob(GB) Wblob(GB)</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">  L0     53/0    2.73 GB   2.7      0.0     0.0      0.0       2.8      2.8       0.0   1.0      0.0      4.1    698.07            115.65        54   12.927       0      0       0.0       0.0</span><br><span class="line"> Sum     53/0    2.73 GB   0.0      0.0     0.0      0.0       2.8      2.8       0.0   1.0      0.0      4.1    698.07            115.65        54   12.927       0      0       0.0       0.0</span><br><span class="line"> Int      0/0    0.00 KB   0.0      0.0     0.0      0.0       1.5      1.5       0.0   1.0      0.0      3.8    403.86             61.34        29   13.926       0      0       0.0       0.0</span><br><span class="line"></span><br><span class="line">** Compaction Stats [default] **</span><br><span class="line">Priority    Files   Size     Score Read(GB)  Rn(GB) Rnp1(GB) Write(GB) Wnew(GB) Moved(GB) W-Amp Rd(MB/s) Wr(MB/s) Comp(sec) CompMergeCPU(sec) Comp(cnt) Avg(sec) KeyIn KeyDrop Rblob(GB) Wblob(GB)</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">High      0/0    0.00 KB   0.0      0.0     0.0      0.0       2.8      2.8       0.0   0.0      0.0      4.1    698.07            115.65        54   12.927       0      0       0.0       0.0</span><br><span class="line"></span><br><span class="line">Blob file count: 0, total size: 0.0 GB</span><br><span class="line"></span><br><span class="line">Uptime(secs): 120.5 total, 60.0 interval</span><br><span class="line">Flush(GB): cumulative 2.785, interval 1.497</span><br><span class="line">AddFile(GB): cumulative 0.000, interval 0.000</span><br><span class="line">AddFile(Total Files): cumulative 0, interval 0</span><br><span class="line">AddFile(L0 Files): cumulative 0, interval 0</span><br><span class="line">AddFile(Keys): cumulative 0, interval 0</span><br><span class="line">Cumulative compaction: 2.79 GB write, 23.67 MB/s write, 0.00 GB <span class="built_in">read</span>, 0.00 MB/s <span class="built_in">read</span>, 698.1 seconds</span><br><span class="line">Interval compaction: 1.50 GB write, 25.54 MB/s write, 0.00 GB <span class="built_in">read</span>, 0.00 MB/s <span class="built_in">read</span>, 403.9 seconds</span><br><span class="line">Stalls(count): 0 level0_slowdown, 0 level0_slowdown_with_compaction, 0 level0_numfiles, 0 level0_numfiles_with_compaction, 0 stop <span class="keyword">for</span> pending_compaction_bytes, 0 slowdown <span class="keyword">for</span> pending_compaction_bytes, 0 memtable_compaction, 51 memtable_slowdown, interval 28 total count</span><br><span class="line">Block cache LRUCache@0x55f687960330<span class="comment">#2714 capacity: 16.00 GB collections: 1 last_copies: 1 last_secs: 0.00024 secs_since: 121</span></span><br><span class="line">Block cache entry stats(count,size,portion): Misc(1,0.00 KB,0%)</span><br><span class="line"></span><br><span class="line">** File Read Latency Histogram By Level [default] **</span><br><span class="line"></span><br><span class="line">** DB Stats **</span><br><span class="line">Uptime(secs): 120.5 total, 60.0 interval</span><br><span class="line">Cumulative writes: 0 writes, 58M keys, 0 commit groups, 0.0 writes per commit group, ingest: 7.35 GB, 62.50 MB/s</span><br><span class="line">Cumulative WAL: 0 writes, 0 syncs, 0.00 writes per sync, written: 0.00 GB, 0.00 MB/s</span><br><span class="line">Cumulative stall: 00:01:17.887 H:M:S, 64.6 percent</span><br><span class="line">Interval writes: 0 writes, 27M keys, 0 commit groups, 0.0 writes per commit group, ingest: 3516.70 MB, 58.61 MB/s</span><br><span class="line">Interval WAL: 0 writes, 0 syncs, 0.00 writes per sync, written: 0.00 GB, 0.00 MB/s</span><br><span class="line">Interval stall: 00:00:42.004 H:M:S, 70.0 percent</span><br><span class="line"></span><br><span class="line">2023/04/13-15:04:48  ... thread 0: (27837000,86336000) ops and (463946.1,479635.3) ops/second <span class="keyword">in</span> (60.000503,180.003431) seconds</span><br><span class="line"></span><br><span class="line">** Compaction Stats [default] **</span><br><span class="line">Level    Files   Size     Score Read(GB)  Rn(GB) Rnp1(GB) Write(GB) Wnew(GB) Moved(GB) W-Amp Rd(MB/s) Wr(MB/s) Comp(sec) CompMergeCPU(sec) Comp(cnt) Avg(sec) KeyIn KeyDrop Rblob(GB) Wblob(GB)</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">  L0     82/0    4.23 GB   4.2      0.0     0.0      0.0       4.2      4.2       0.0   1.0      0.0      4.0   1076.38            170.62        82   13.127       0      0       0.0       0.0</span><br><span class="line"> Sum     82/0    4.23 GB   0.0      0.0     0.0      0.0       4.2      4.2       0.0   1.0      0.0      4.0   1076.38            170.62        82   13.127       0      0       0.0       0.0</span><br><span class="line"> Int      0/0    0.00 KB   0.0      0.0     0.0      0.0       1.4      1.4       0.0   1.0      0.0      3.9    378.31             54.97        28   13.511       0      0       0.0       0.0</span><br><span class="line"></span><br><span class="line">** Compaction Stats [default] **</span><br><span class="line">Priority    Files   Size     Score Read(GB)  Rn(GB) Rnp1(GB) Write(GB) Wnew(GB) Moved(GB) W-Amp Rd(MB/s) Wr(MB/s) Comp(sec) CompMergeCPU(sec) Comp(cnt) Avg(sec) KeyIn KeyDrop Rblob(GB) Wblob(GB)</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">High      0/0    0.00 KB   0.0      0.0     0.0      0.0       4.2      4.2       0.0   0.0      0.0      4.0   1076.38            170.62        82   13.127       0      0       0.0       0.0</span><br><span class="line"></span><br><span class="line">Blob file count: 0, total size: 0.0 GB</span><br><span class="line"></span><br><span class="line">Uptime(secs): 180.5 total, 60.0 interval</span><br><span class="line">Flush(GB): cumulative 4.229, interval 1.444</span><br><span class="line">AddFile(GB): cumulative 0.000, interval 0.000</span><br><span class="line">AddFile(Total Files): cumulative 0, interval 0</span><br><span class="line">AddFile(L0 Files): cumulative 0, interval 0</span><br><span class="line">AddFile(Keys): cumulative 0, interval 0</span><br><span class="line">Cumulative compaction: 4.23 GB write, 23.99 MB/s write, 0.00 GB <span class="built_in">read</span>, 0.00 MB/s <span class="built_in">read</span>, 1076.4 seconds</span><br><span class="line">Interval compaction: 1.44 GB write, 24.65 MB/s write, 0.00 GB <span class="built_in">read</span>, 0.00 MB/s <span class="built_in">read</span>, 378.3 seconds</span><br><span class="line">Stalls(count): 0 level0_slowdown, 0 level0_slowdown_with_compaction, 0 level0_numfiles, 0 level0_numfiles_with_compaction, 0 stop <span class="keyword">for</span> pending_compaction_bytes, 0 slowdown <span class="keyword">for</span> pending_compaction_bytes, 0 memtable_compaction, 79 memtable_slowdown, interval 28 total count</span><br><span class="line">Block cache LRUCache@0x55f687960330<span class="comment">#2714 capacity: 16.00 GB collections: 1 last_copies: 1 last_secs: 0.00024 secs_since: 181</span></span><br><span class="line">Block cache entry stats(count,size,portion): Misc(1,0.00 KB,0%)</span><br><span class="line"></span><br><span class="line">** File Read Latency Histogram By Level [default] **</span><br><span class="line"></span><br><span class="line">** DB Stats **</span><br><span class="line">Uptime(secs): 180.5 total, 60.0 interval</span><br><span class="line">Cumulative writes: 0 writes, 86M keys, 0 commit groups, 0.0 writes per commit group, ingest: 10.85 GB, 61.58 MB/s</span><br><span class="line">Cumulative WAL: 0 writes, 0 syncs, 0.00 writes per sync, written: 0.00 GB, 0.00 MB/s</span><br><span class="line">Cumulative stall: 00:02:1.031 H:M:S, 67.0 percent</span><br><span class="line">Interval writes: 0 writes, 27M keys, 0 commit groups, 0.0 writes per commit group, ingest: 3583.90 MB, 59.73 MB/s</span><br><span class="line">Interval WAL: 0 writes, 0 syncs, 0.00 writes per sync, written: 0.00 GB, 0.00 MB/s</span><br><span class="line">Interval stall: 00:00:43.144 H:M:S, 71.9 percent</span><br><span class="line"></span><br><span class="line">Initializing RocksDB Options from the specified file</span><br><span class="line">Initializing RocksDB Options from command-line flags</span><br><span class="line">Keys:       20 bytes each (+ 0 bytes user-defined timestamp)</span><br><span class="line">Values:     100 bytes each (50 bytes after compression)</span><br><span class="line">Entries:    10000000</span><br><span class="line">Prefix:    0 bytes</span><br><span class="line">Keys per prefix:    0</span><br><span class="line">RawSize:    1144.4 MB (estimated)</span><br><span class="line">FileSize:   667.6 MB (estimated)</span><br><span class="line">Write rate: 0 bytes/second</span><br><span class="line">Read rate: 0 ops/second</span><br><span class="line">Compression: ZSTD</span><br><span class="line">Compression sampling rate: 0</span><br><span class="line">Memtablerep: VectorRepFactory</span><br><span class="line">Perf Level: 1</span><br><span class="line">WARNING: Assertions are enabled; benchmarks unnecessarily slow</span><br><span class="line">------------------------------------------------</span><br><span class="line">Initializing RocksDB Options from the specified file</span><br><span class="line">Initializing RocksDB Options from command-line flags</span><br><span class="line">DB path: [/tmp/rocksdb/db]</span><br><span class="line">fillrandom   :       2.085 micros/op 479677 ops/sec;   54.9 MB/s</span><br><span class="line">Microseconds per write:</span><br><span class="line">Count: 86346999 Average: 2.0847  StdDev: 40.44</span><br><span class="line">Min: 0  Median: 0.5086  Max: 30633</span><br><span class="line">Percentiles: P50: 0.51 P75: 0.76 P99: 1.81 P99.9: 961.81 P99.99: 1266.70</span><br><span class="line">------------------------------------------------------</span><br><span class="line">[       0,       1 ] 84890082  98.313%  98.313% <span class="comment">####################</span></span><br><span class="line">(       1,       2 ]   735804   0.852%  99.165%</span><br><span class="line">(       2,       3 ]   298782   0.346%  99.511%</span><br><span class="line">(       3,       4 ]    52267   0.061%  99.571%</span><br><span class="line">(       4,       6 ]    11956   0.014%  99.585%</span><br><span class="line">(       6,      10 ]     4381   0.005%  99.590%</span><br><span class="line">(      10,      15 ]    13884   0.016%  99.606%</span><br><span class="line">(      15,      22 ]   141096   0.163%  99.770%</span><br><span class="line">(      22,      34 ]    51510   0.060%  99.829%</span><br><span class="line">(      34,      51 ]    23390   0.027%  99.857%</span><br><span class="line">(      51,      76 ]     9056   0.010%  99.867%</span><br><span class="line">(      76,     110 ]     3030   0.004%  99.871%</span><br><span class="line">(     110,     170 ]     1135   0.001%  99.872%</span><br><span class="line">(     170,     250 ]      403   0.000%  99.872%</span><br><span class="line">(     250,     380 ]      217   0.000%  99.873%</span><br><span class="line">(     380,     580 ]      114   0.000%  99.873%</span><br><span class="line">(     580,     870 ]      144   0.000%  99.873%</span><br><span class="line">(     870,    1300 ]   109602   0.127% 100.000%</span><br><span class="line">(    1300,    1900 ]       58   0.000% 100.000%</span><br><span class="line">(    1900,    2900 ]       18   0.000% 100.000%</span><br><span class="line">(    2900,    4400 ]       22   0.000% 100.000%</span><br><span class="line">(    4400,    6600 ]       16   0.000% 100.000%</span><br><span class="line">(    6600,    9900 ]       16   0.000% 100.000%</span><br><span class="line">(    9900,   14000 ]        9   0.000% 100.000%</span><br><span class="line">(   14000,   22000 ]        5   0.000% 100.000%</span><br><span class="line">(   22000,   33000 ]        2   0.000% 100.000%</span><br><span class="line"></span><br><span class="line">Compacting...</span><br><span class="line">./db_bench --benchmarks=compact --use_existing_db=1 --disable_auto_compactions=1 --sync=0 --level0_file_num_compaction_trigger=4 --level0_stop_writes_trigger=20 --max_background_compactions=16 --max_write_buffer_number=8 --max_background_flushes=7 --db=/tmp/rocksdb/db --wal_dir=/tmp/rocksdb/wal --num=8000000000 --num_levels=6 --key_size=20 --value_size=400 --block_size=8192 --cache_size=17179869184 --cache_numshardbits=6 --compression_max_dict_bytes=0 --compression_ratio=0.5 --compression_type=zstd --level_compaction_dynamic_level_bytes=<span class="literal">true</span> --bytes_per_sync=8388608 --cache_index_and_filter_blocks=0 --pin_l0_filter_and_index_blocks_in_cache=1 --benchmark_write_rate_limit=0 --hard_rate_limit=3 --rate_limit_delay_max_milliseconds=1000000 --write_buffer_size=134217728 --target_file_size_base=134217728 --max_bytes_for_level_base=1073741824 --verify_checksum=1 --delete_obsolete_files_period_micros=62914560 --max_bytes_for_level_multiplier=8 --statistics=0 --stats_per_interval=1 --stats_interval_seconds=60 --histogram=1 --memtablerep=skip_list --bloom_bits=10 --open_files=-1 --num=10000000 --value_size=100 --duration=180 --threads=1 2&gt;&amp;1 | tee -a /tmp/rocksdb/output/benchmark_bulkload_compact.log</span><br><span class="line">RocksDB:    version 6.29</span><br><span class="line">Date:       Thu Apr 13 15:05:02 2023</span><br><span class="line">CPU:        6 * Intel(R) Core(TM) i5-8500 CPU @ 3.00GHz</span><br><span class="line">CPUCache:   9216 KB</span><br><span class="line">Initializing RocksDB Options from the specified file</span><br><span class="line">Initializing RocksDB Options from command-line flags</span><br><span class="line">Keys:       20 bytes each (+ 0 bytes user-defined timestamp)</span><br><span class="line">Values:     100 bytes each (50 bytes after compression)</span><br><span class="line">Entries:    10000000</span><br><span class="line">Prefix:    0 bytes</span><br><span class="line">Keys per prefix:    0</span><br><span class="line">RawSize:    1144.4 MB (estimated)</span><br><span class="line">FileSize:   667.6 MB (estimated)</span><br><span class="line">Write rate: 0 bytes/second</span><br><span class="line">Read rate: 0 ops/second</span><br><span class="line">Compression: ZSTD</span><br><span class="line">Compression sampling rate: 0</span><br><span class="line">Memtablerep: SkipListFactory</span><br><span class="line">Perf Level: 1</span><br><span class="line">WARNING: Assertions are enabled; benchmarks unnecessarily slow</span><br><span class="line">------------------------------------------------</span><br><span class="line">DB path: [/tmp/rocksdb/db]</span><br><span class="line">compact      : 60822353.000 micros/op 0 ops/sec;</span><br><span class="line">Completed bulkload (ID: ) <span class="keyword">in</span> 263 seconds</span><br><span class="line">ops/sec mb/sec  Size-GB L0_GB   Sum_GB  W-Amp   W-MB/s  usec/op p50     p75     p99     p99.9   p99.99  Uptime  Stall-time      Stall%  Test    Date    Version Job-ID</span><br><span class="line">479677  54.9    0.0     4.2     4.2     1.0     23.8    2.1     0.5     0.8     2       962     1267    180     00:02:1.031     67.0    bulkload        2023-04-13T15:01:47.000+08:00   6.29</span><br></pre></td></tr></table></figure>

<h3 id="测试报告简单理解"><a href="#测试报告简单理解" class="headerlink" title="测试报告简单理解"></a>测试报告简单理解</h3><p>在 RocksDB 的 db_bench 基准测试工具中，测试报告会在测试结束后自动生成。报告包含了多个测试结果指标，可以用来评估 RocksDB 的读写性能以及其他指标。下面是一些常见的测试结果指标：</p>
<ul>
<li>ops/sec：每秒操作数，表示 RocksDB 每秒能够执行的读写操作数量。</li>
<li>MB/s：每秒传输的数据量，表示 RocksDB 每秒能够读写的数据量。</li>
<li>Latency(at 50th/90th/99th percentile)：响应时间，表示 RocksDB 的读写操作的平均响应时间。50th、90th 和 99th percentile 分别表示操作响应时间在前 50%、90% 和 99% 的操作的响应时间。</li>
<li>Stalls(count)：表示 RocksDB 因为某些原因而停止工作的次数。</li>
</ul>
<p>测试报告的每一行对应一次测试结果，列出了 RocksDB 在测试过程中的各项性能指标。报告的最后几行总结了测试结果，并给出了平均值和标准差等统计信息。</p>
<p>在评估测试报告时，需要注意不同测试模式的结果指标可能会有所不同，需要结合实际情况进行评估。同时，需要注意测试结果受多种因素影响，包括测试数据集的大小、读写操作的类型、硬件环境等，因此需要进行多次测试并综合考虑。</p>
<h2 id="跑点高级特性吧"><a href="#跑点高级特性吧" class="headerlink" title="跑点高级特性吧"></a>跑点高级特性吧</h2><p>可以后续研究一下 </p>
<h2 id="其他-清理"><a href="#其他-清理" class="headerlink" title="其他(清理)"></a>其他(清理)</h2><p>注意: <strong>会清掉 db_bench 运行文件，所以谨慎使用</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清理掉编译产生的很多的 *.d 文件，不影响 librocksdb.a 库的使用</span></span><br><span class="line">make clean</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/renjc/archive/2021/01/15/rocksdb-install.html">Ubuntu安装Rocksdb并调试</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/alipay.jpg" alt="单林敏 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/ARST/" rel="tag"># ARST</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/ARST%E6%89%93%E5%8D%A1%E7%AC%AC205%E5%91%A8-205-521/" rel="prev" title="ARST打卡第205周[205/521]">
                  <i class="fa fa-chevron-left"></i> ARST打卡第205周[205/521]
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/ARST%E6%89%93%E5%8D%A1%E7%AC%AC207%E5%91%A8-207-521/" rel="next" title="ARST打卡第207周[207/521]">
                  ARST打卡第207周[207/521] <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">湘ICP备19025607号 </a>
  </div>

<div class="copyright">
  &copy; 2019 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">单林敏</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"wolfdan666","repo":"gitalk_commont","client_id":"2934cb0fdcabc560461e","client_secret":"937e7b77dcdfd83f6a89f4a9b9447a76a54bc764","admin_user":"wolfdan666","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"061a592ef13a26c720771aae84cd557a"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
